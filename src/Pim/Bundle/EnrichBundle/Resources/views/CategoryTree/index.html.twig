{% extends 'PimEnrichBundle::layout.html.twig' %}

{% block head_script %}
    {{ parent() }}
{% endblock %}

{% block content %}
    <div id="categories-edit-form"></div>
    <script>
        require(
            ['jquery', 'pim/fetcher-registry', 'pim/form-builder', 'pim/error', 'routing'],
            function ($, FetcherRegistry, FormBuilder, Error, Routing) {
                $(function () {


                    //TODO ALBAN => mettre tout Ã§a au propre!
                    FetcherRegistry.initialize().done(function () {
                        FetcherRegistry.getFetcher('category').fetchAll()
                            .then(function () {
                                console.log("all", arguments);
                                FormBuilder.build('pim-categories-edit-form')
                                    .then(function (form) {

                                        form.setElement('#categories-edit-form').render();
                                        //DO NOT COMMIT!! => faire comme pour edit product
                                        //Quick hack for managing deeplink
                                        //Waiting to be refactored after the merge of PRXXX  ...
                                        console.log("!!!!!!!!", Backbone.history.location.hash);
                                        var editing = window.location.href.match(/category-tree\/.*\/edit/g);
                                        if(editing){
                                            var categoryCode = editing[0].split("/")[1];
                                            console.log("Editing code??", categoryCode);
                                           setTimeout(function () {
                                                $('li[data-code="'+categoryCode+'"] a')[0].click();
                                            }, 1000);
                                        }
                                        //form.toto()
                                       // test();
                                    });
                                /*FetcherRegistry.getFetcher('category').fetch('sales')
                                 .then(function () {
                                 console.log("sales", arguments);
                                 //debugger;
                                 })*/
                            })
                    })


                })
            });

    </script>
{% endblock %}
